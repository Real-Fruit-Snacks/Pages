NAME

oz-generate-icicle
- tool to generate an ICICLE (package manifest) of a disk
image

SYNOPSIS

oz-generate-icicle
[OPTIONS]  

DESCRIPTION

This is a tool
to generate a package manifest (also called ICICLE) from a
disk image. This program can be used as a counterpart to
oz-install, though it does not have to be used in
conjunction.

Note that
oz-generate-icicle does the actual work using a combination
of KVM and libvirt, so both of these must be available (and
working) for oz-generate-icicle to have a chance to
succeed.

OPTIONS

-c

Get the configuration from
config file config, instead of the default
/etc/oz/oz.cfg. If neither one exists, Oz will use sensible
defaults. The config file is in standard ini format; for an
explanation of the sections and keys, see the
CONFIGURATION FILE section.

-d 

Turn on debugging output to
level loglevel. The log levels are: 
0 - errors only (this is the default) 
1 - errors and warnings 
2 - errors, warnings, and information 
3 - all messages 
4 - all messages, prepended with the level and classname

-h

Print a short help message.

-i 

oz-generate-icicle will
normally write the ICICLE XML to stdout. To have
oz-generate-icicle write the ICICLE to a file instead, use
this option.

CONFIGURATION FILE

The Oz
configuration file is in standard INI format with several
sections. If any section or configuration key is missing, Oz
will use a sensible default. For true/false configuration
keys, the values of "true", "True",
"yes", or "Yes" can be used to turn the
option on, and "false", "False",
"no", or "No" can be used to turn the
behavior off. The configuration file should have the
following form:

[paths] 
output_dir = /var/lib/libvirt/images 
data_dir = /var/lib/oz 
screenshot_dir = . 
sshprivkey = /etc/oz/id_rsa-icicle-gen

[libvirt] 
uri = qemu:///system 
type = kvm 
bridge_name = virbr0 
cpus = 1 
memory = 1024 
image_type = raw

[cache] 
original_media = yes 
modified_media = no 
jeos = no

[icicle] 
safe_generation = no

The
paths section defines the paths that Oz will use for
storing data. The output_dir key describes where to
store the images after they are built, and the
data_dir key describes where to cache install media
and use temporary storage. Both locations must have a decent
amount of free disk space in order for Oz to work properly.
The screenshot_dir key describes where to store
screenshots of failed installs. The sshprivkey key
describes where the ssh keys are stored, which are required
by Oz to do customization of the image.

The
libvirt section allows some manipulation of how Oz
uses libvirt. The uri key describes the libvirt URI
to use to do the guest installation. The type key
defines what type of virtualization to use. The
bridge_name key defines which bridge Oz should place
the guests that it launches on. The cpus key defines
how many cpus should be used inside the virtual machine. The
memory key defines how much memory (in megabytes)
should be used inside the virtual machine. The
image_type key defines which output disk type should
be used; this can be any value that libvirt supports.

The
cache section allows some manipulation of how Oz
caches data. The caching of data in Oz is a tradeoff between
installation time and storage space. The
original_media key tells Oz to cache the original
installation media so that it does not have to download it
the next time an install for the same operating system is
requested. The modified_media key tells Oz to cache
the oz-modified installation media so that it does not have
to download and modify it the next time an install for the
same operating system is requested. The jeos key
tells Oz to cache the installed operating system after
installation. This can significantly speed up subsequent
installation of the same operating system, with the
additional downside of the operating system getting
out-of-date with respect to security updates. Use with
care.

The
icicle section allows some manipulation of how Oz
generates ICICLE output. ICICLE is a package manifest that
can optionally be generated at the end of installs. The
safe_generation key controls whether Oz uses a
throwaway overlay file while generating the ICICLE. If it is
set to "no" (the default), then Oz will boot up
the guest at the end of the install and run the appropriate
commands to generate the ICICLE. If it is set to
"yes", then Oz will use a throwaway overlay file
while generating the ICICLE. After the ICICLE is generated,
Oz will delete the backing file, leaving the original disk
image pristine.

SEE ALSO

oz-install(1),
oz-customize(1), oz-cleanup-cache(1), oz-examples(1)

AUTHOR

Chris
Lalancette clalancette [AT] gmail.com>