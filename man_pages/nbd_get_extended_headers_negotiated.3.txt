NAME

nbd_get_extended_headers_negotiated
- see if extended headers are in use

SYNOPSIS

#include

int nbd_get_extended_headers_negotiated ( 
struct nbd_handle *h 
);

DESCRIPTION

After
connecting you may call this to find out if the connection
is using extended headers. Note that this setting is sticky;
this can return true even after a second
nbd_opt_extended_headers(3) returns false because the
server detected a duplicate request.

When extended
headers are not in use, commands are limited to a 32-bit
length, even when the libnbd API uses a 64-bit parameter to
express the length. But even when extended headers are
supported, the server may enforce other limits, visible
through nbd_get_block_size(3).

Note that when
extended headers are negotiated, you should prefer the use
of nbd_block_status_64(3) instead of
nbd_block_status(3) if any of the meta contexts you
requested via nbd_add_meta_context(3) might return
64-bit status values; however, all of the well-known meta
contexts covered by current "LIBNBD_CONTEXT_*"
constants only return 32-bit status.

RETURN VALUE

This call
returns a boolean value.

ERRORS

On error -1 is
returned.

Refer to
"ERROR HANDLING" in libnbd(3) for how to
get further details of the error.

The following
parameters must not be NULL: "h". For more
information see "Non-NULL parameters" in
libnbd(3).

HANDLE STATE

nbd_get_extended_headers_negotiated
can be called when the handle is in the following
states:

┌─────────────────────────────────────┬─────────────────────────┐

│ Handle created, before connecting │ ❌
error │ 
│ Connecting │ ❌ error │ 
│ Connecting & handshaking (opt_mode) │
✅ allowed │ 
│ Connected to the server │ ✅ allowed
│ 
│ Connection shut down │ ✅ allowed │

│ Handle dead │ ❌ error │ 

└─────────────────────────────────────┴─────────────────────────┘

VERSION

This function
first appeared in libnbd 1.18.

If you need to
test if this function is available at compile time check if
the following macro is defined:

#define
LIBNBD_HAVE_NBD_GET_EXTENDED_HEADERS_NEGOTIATED 1

SEE ALSO

nbd_add_meta_context(3),
nbd_block_status(3), nbd_block_status_64(3),
nbd_cache(3), nbd_create(3),
nbd_get_block_size(3), nbd_get_protocol(3),
nbd_get_request_extended_headers(3),
nbd_get_structured_replies_negotiated(3),
nbd_opt_extended_headers(3),
nbd_set_request_extended_headers(3),
nbd_trim(3), nbd_zero(3),
libnbd(3).

AUTHORS

Eric Blake

Richard W.M.
Jones

COPYRIGHT

Copyright Red
Hat

LICENSE

This library is
free software; you can redistribute it and/or modify it
under the terms of the GNU Lesser General Public License as
published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This library is
distributed in the hope that it will be useful, but WITHOUT
ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU Lesser General Public License for more details.

You should have
received a copy of the GNU Lesser General Public License
along with this library; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
MA 02110-1301 USA