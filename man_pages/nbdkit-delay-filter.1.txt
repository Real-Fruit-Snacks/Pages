NAME

nbdkit-delay-filter
- nbdkit delay filter

SYNOPSIS

nbdkit
--filter=delay plugin rdelay=SECS wdelay=SECS
[plugin-args...]

nbdkit
--filter=delay plugin rdelay=NNms wdelay=NNms
[plugin-args...]

nbdkit
--filter=delay plugin [plugin-args ...] 
delay-read=(SECS|NNms) 
delay-write=(SECS|NNms) 
delay-zero=(SECS|NNms) 
delay-trim=(SECS|NNms) 
delay-extents=(SECS|NNms) 
delay-cache=(SECS|NNms) 
delay-fast-zero=BOOL 
delay-open=(SECS|NNms) 
delay-close=(SECS|NNms)

DESCRIPTION

"nbdkit-delay-filter"
is a filter that delays read and write requests by some
seconds or milliseconds. This is used to simulate a slow or
remote server, or to test certain kinds of race conditions
in Linux. To limit server bandwidth use
nbdkit-rate-filter(1) instead.

EXAMPLES

Delays reads
and writes by 100ms:

nbdkit
--filter=delay file disk.img rdelay=100ms wdelay=100ms

Delay only zero
operations by 1 second, nothing else is affected:

nbdkit
--filter=delay file disk.img delay-zero=1

PARAMETERS

rdelay=SECS

rdelay=NNms 
delay-read=SECS 
delay-read=NNms

Delay read operations by
"SECS" seconds or "NN" milliseconds.

The two forms
"rdelay" and "delay-read" work
identically.

delay-write=SECS 
delay-write=NNms

Delay write operations by
"SECS" seconds or "NN" milliseconds.

delay-zero=SECS 
delay-zero=NNms

(nbdkit &ge; 1.10)

Delay zero
operations by "SECS" seconds or "NN"
milliseconds. See also delay-fast-zero.

delay-trim=SECS 
delay-trim=NNms

(nbdkit &ge; 1.10)

Delay
trim/discard operations by "SECS" seconds or
"NN" milliseconds.

delay-extents=SECS

delay-extents=NNms

(nbdkit &ge; 1.12)

Delay block
status (extents) operations by "SECS" seconds or
"NN" milliseconds.

delay-cache=SECS 
delay-cache=NNms

(nbdkit &ge; 1.14)

Delay advisory
cache operations by "SECS" seconds or
"NN" milliseconds.

wdelay=SECS 
wdelay=NNms

Delay write, zero and trim
operations by "SECS" seconds or "NN"
milliseconds.

delay-fast-zero=BOOL

(nbdkit &ge; 1.16)

The NBD
specification documents an extension called fast zero, in
which the client may request that a server should reply with
"ENOTSUP" as soon as possible if the zero
operation offers no real speedup over a corresponding write.
By default, this parameter is true, and fast zero requests
are serviced by the plugin after the same delay as any other
zero request; but setting this parameter to false instantly
fails a fast zero response without waiting for or consulting
the plugin.

delay-open=SECS 
delay-open=NNms

(nbdkit &ge; 1.28)

Delay open
(client connection) by "SECS" seconds or
"NN" milliseconds.

delay-close=SECS 
delay-close=NNms

(nbdkit &ge; 1.28)

Delay close
(client disconnection) by "SECS" seconds or
"NN" milliseconds. This can also cause server
shutdown to be delayed if clients are connected at the time.
This only affects clients that gracefully disconnect (using
"NBD_CMD_DISC" / libnbd function
nbd_shutdown(3)). Clients that abruptly disconnect
from the server cannot be delayed.

FILES

$filterdir/nbdkit-delay-filter.so

The filter.

Use
"nbdkit --dump-config" to find the location of
$filterdir.

VERSION

"nbdkit-delay-filter"
first appeared in nbdkit 1.2, based on earlier
"rdelay" and "wdelay" options in
nbdkit-file-plugin(1).

SEE ALSO

nbdkit(1),
nbdkit-filter(3), nbdkit-pause-filter(1),
nbdkit-rate-filter(1).

AUTHORS

Richard W.M.
Jones

COPYRIGHT

Copyright Red
Hat

LICENSE

Redistribution
and use in source and binary forms, with or without
modification, are permitted provided that the following
conditions are met:

&bull;

Redistributions of source code must retain the above
copyright notice, this list of conditions and the following
disclaimer. 

&bull;

Redistributions in binary form must reproduce the above
copyright notice, this list of conditions and the following
disclaimer in the documentation and/or other materials
provided with the distribution.

&bull;

Neither the name of Red Hat nor the names of its
contributors may be used to endorse or promote products
derived from this software without specific prior written
permission. 

THIS SOFTWARE
IS PROVIDED BY RED HAT AND CONTRIBUTORS &rsquo;&rsquo;AS
IS&rsquo;&rsquo; AND ANY EXPRESS OR IMPLIED WARRANTIES,
INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL RED HAT OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.