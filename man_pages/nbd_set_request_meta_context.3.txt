NAME

nbd_set_request_meta_context
- control whether connect automatically requests meta
contexts

SYNOPSIS

#include

int nbd_set_request_meta_context ( 
struct nbd_handle *h, bool request 
);

DESCRIPTION

This function
controls whether the act of connecting to an export (all
"nbd_connect_*" calls when
nbd_set_opt_mode(3) is false, or nbd_opt_go(3)
and nbd_opt_info(3) when option mode is enabled) will
also try to issue NBD_OPT_SET_META_CONTEXT when the server
supports structured replies or extended headers and any
contexts were registered by nbd_add_meta_context(3).
The default setting is true; however the extra step of
negotiating meta contexts is not always desirable:
performing both info and go on the same export works without
needing to re-negotiate contexts on the second call;
integration testing of other servers may benefit from manual
invocation of nbd_opt_set_meta_context(3) at other
times in the negotiation sequence; and even when using just
nbd_opt_info(3), it can be faster to collect the
server&rsquo;s results by relying on the callback function
passed to nbd_opt_list_meta_context(3) than a series
of post-process calls to nbd_can_meta_context(3).

Note that this
control has no effect if the server does not negotiate
structured replies or extended headers, or if the client did
not request any contexts via nbd_add_meta_context(3).
Setting this control to false may cause
nbd_block_status(3) to fail.

RETURN VALUE

If the call is
successful the function returns 0.

ERRORS

On error -1 is
returned.

Refer to
"ERROR HANDLING" in libnbd(3) for how to
get further details of the error.

The following
parameters must not be NULL: "h". For more
information see "Non-NULL parameters" in
libnbd(3).

HANDLE STATE

nbd_set_request_meta_context
can be called when the handle is in the following
states:

&#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;

&#9474; Handle created, before connecting &#9474; &#9989;
allowed &#9474; 
&#9474; Connecting &#9474; &#10060; error &#9474; 
&#9474; Connecting & handshaking (opt_mode) &#9474;
&#9989; allowed &#9474; 
&#9474; Connected to the server &#9474; &#10060; error
&#9474; 
&#9474; Connection shut down &#9474; &#10060; error &#9474;

&#9474; Handle dead &#9474; &#10060; error &#9474; 

&#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;

VERSION

This function
first appeared in libnbd 1.16.

If you need to
test if this function is available at compile time check if
the following macro is defined:

#define
LIBNBD_HAVE_NBD_SET_REQUEST_META_CONTEXT 1

SEE ALSO

nbd_add_meta_context(3),
nbd_block_status(3), nbd_can_meta_context(3),
nbd_create(3),
nbd_get_request_meta_context(3),
nbd_get_structured_replies_negotiated(3),
nbd_opt_go(3), nbd_opt_info(3),
nbd_opt_list_meta_context(3),
nbd_opt_set_meta_context(3),
nbd_set_opt_mode(3), libnbd(3).

AUTHORS

Eric Blake

Richard W.M.
Jones

COPYRIGHT

Copyright Red
Hat

LICENSE

This library is
free software; you can redistribute it and/or modify it
under the terms of the GNU Lesser General Public License as
published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This library is
distributed in the hope that it will be useful, but WITHOUT
ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU Lesser General Public License for more details.

You should have
received a copy of the GNU Lesser General Public License
along with this library; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
MA 02110-1301 USA