NAME

nbd_opt_info -
request the server for information about an export

SYNOPSIS

#include

int nbd_opt_info ( 
struct nbd_handle *h 
);

DESCRIPTION

Request that
the server supply information about the export name
previously specified by the most recent
nbd_set_export_name(3) or nbd_connect_uri(3).
This can only be used if nbd_set_opt_mode(3) enabled
option mode.

If successful,
functions like nbd_is_read_only(3) and
nbd_get_size(3) will report details about that
export. If nbd_set_request_meta_context(3) is set
(the default) and structured replies or extended headers
were negotiated, it is also valid to use
nbd_can_meta_context(3) after this call. However, it
may be more efficient to clear that setting and manually
utilize nbd_opt_list_meta_context(3) with its
callback approach, for learning which contexts an export
supports. In general, if nbd_opt_go(3) is called
next, that call will likely succeed with the details
remaining the same, although this is not guaranteed by all
servers.

Not all servers
understand this request, and even when it is understood, the
server might fail the request even when a corresponding
nbd_opt_go(3) would succeed.

RETURN VALUE

If the call is
successful the function returns 0.

ERRORS

On error -1 is
returned.

Refer to
"ERROR HANDLING" in libnbd(3) for how to
get further details of the error.

The following
parameters must not be NULL: "h". For more
information see "Non-NULL parameters" in
libnbd(3).

HANDLE STATE

nbd_opt_info
can be called when the handle is in the following state:

┌─────────────────────────────────────┬─────────────────────────┐

│ Handle created, before connecting │ ❌
error │ 
│ Connecting │ ❌ error │ 
│ Connecting & handshaking (opt_mode) │
✅ allowed │ 
│ Connected to the server │ ❌ error
│ 
│ Connection shut down │ ❌ error │

│ Handle dead │ ❌ error │ 

└─────────────────────────────────────┴─────────────────────────┘

VERSION

This function
first appeared in libnbd 1.4.

If you need to
test if this function is available at compile time check if
the following macro is defined:

#define
LIBNBD_HAVE_NBD_OPT_INFO 1

SEE ALSO

nbd_aio_opt_info(3),
nbd_can_meta_context(3), nbd_connect_uri(3),
nbd_create(3), nbd_get_size(3),
nbd_is_read_only(3), nbd_opt_go(3),
nbd_opt_list_meta_context(3),
nbd_set_export_name(3), nbd_set_opt_mode(3),
nbd_set_request_meta_context(3),
libnbd(3).

AUTHORS

Eric Blake

Richard W.M.
Jones

COPYRIGHT

Copyright Red
Hat

LICENSE

This library is
free software; you can redistribute it and/or modify it
under the terms of the GNU Lesser General Public License as
published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This library is
distributed in the hope that it will be useful, but WITHOUT
ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU Lesser General Public License for more details.

You should have
received a copy of the GNU Lesser General Public License
along with this library; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
MA 02110-1301 USA