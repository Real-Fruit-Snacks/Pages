NAME

nbdkit-release-notes-1.28
- release notes for nbdkit 1.28

DESCRIPTION

These are the
release notes for nbdkit stable release 1.28. This describes
the major changes since 1.26.

nbdkit 1.28.0
was released on 23 September 2021.

Security

CVE-2021-3716 reset structured replies on starttls

nbdkit was
vulnerable to injected plaintext when upgrading to a secure
connection. For the full announcement see
https://www.redhat.com/archives/libguestfs/2021-August/msg00083.html
(Eric Blake).

All past
security issues and information about how to report new ones
can be found in nbdkit-security(1).

Plugins 
nbdkit-data-plugin(1) has new "le:"
and "be:" prefixes for little and big
endian words. Also the plugin tries much harder to optimize
expressions. The test suite has been greatly expanded to
catch potential regressions.

nbdkit-floppy-plugin(1)
now allows you to reserve free space (Nolan Leake).

nbdkit-ssh-plugin(1)
no longer references SHA1 host keys as part of the effort to
remove insecure algorithms (Daniel Berrangé).

nbdkit-vddk-plugin(1)
reports "can_flush" and "can_fua" based
on what the version of VDDK supports. New debug flag -D
vddk.stats=1 prints the amount of time spent in VDDK
calls on exit which can be useful for profiling
performance.

Filters 
nbdkit-cow-filter(1) and nbdkit-cache-filter(1)
no longer break up large read requests into page-sized
requests. In addition the default block size for both
filters is now 64K. Both changes greatly improve
performance.

nbdkit-cache-filter(1)
has a new "cache-on-read=/PATH" parameter allowing
callers to enable and disable the cache-on-read feature at
runtime. Also there is a new
"cache-min-block-size" parameter letting you
select the block size at runtime (thanks Martin
Kletzander).

nbdkit-cow-filter(1)
has a new "cow-on-read" parameter which works
similarly to the corresponding cache filter feature. The new
"cow-block-size" parameter lets you select the
block size at runtime.

nbdkit-cow-filter(1)
has less verbose debugging. To restore the old debug output
use -D cow.verbose=1

nbdkit-delay-filter(1)
has new "delay-open" and "delay-close"
parameters to inject delays when clients connect and
disconnect. Delay filter parameters are now parsed more
accurately (thanks Ming Xie).

Language
bindings 
The OCaml bindings now call "caml_shutdown" when
unloading the plugin. This causes "Stdlib.at_exit"
handlers to run correctly, closes file descriptors, releases
dependent shared libraries and frees memory. Valgrind on
OCaml plugins should not show any false positives about
leaked memory.

OCaml and
Python bindings may now use the ".cleanup"
method.

References to
Python 2 in nbdkit-python-plugin(3) have been
removed.

Server

Fix captive nbdkit $uri variable so when TLS is used the URI
is constructed with the "nbds:" prefix.
Additionally add a new variable $tls which can be used by
the subprocess to tell if TLS is enabled.

Debug messages
are now printed atomically. This means that debug messages
are no longer broken up across multiple lines if there are
other processes writing to stderr at the same time (which
often happened when using captive nbdkit).

Enhanced
valgrind support (./configure --enable-valgrind) can
now be enabled safely and with no performance impact even in
production builds (Eric Blake).

API 
Plugins or filters using "nbdkit_nanosleep" now
don’t hang if the client closes the socket abruptly
(thanks Ming Xie).

Bug fixes

nbdkit-data-plugin(1) and nbdkit-memory-plugin(1)
using allocator=malloc no longer crash because of memory
corruption in some corner cases (only seen on s390x, but
could happen on other architectures). Meanwhile
"allocator=zstd" no longer crashes when zeroing
unallocated space.

Tests

Tests now use the new "GLIBC_TUNABLES" feature,
replacing "MALLOC_CHECK_" on glibc ≥ 2.34
(thanks Eric Blake, Siddhesh Poyarekar).

Build

configure.ac now uses spaces consistently, and has been
modernized to support the latest autotools (Eric Blake).

podwrapper.pl
has been unified (almost) with the copy in libnbd.

Continue
fuzzing using AFL++. Updated the fuzzing documentation.

SEE ALSO

nbdkit(1).

AUTHORS

Authors of
nbdkit 1.28: 
Daniel P. Berrangé 
Eric Blake 
Martin Kletzander 
Nolan Leake 
Richard W.M. Jones

COPYRIGHT

Copyright Red
Hat

LICENSE

Redistribution
and use in source and binary forms, with or without
modification, are permitted provided that the following
conditions are met:

•

Redistributions of source code must retain the above
copyright notice, this list of conditions and the following
disclaimer. 

•

Redistributions in binary form must reproduce the above
copyright notice, this list of conditions and the following
disclaimer in the documentation and/or other materials
provided with the distribution.

•

Neither the name of Red Hat nor the names of its
contributors may be used to endorse or promote products
derived from this software without specific prior written
permission. 

THIS SOFTWARE
IS PROVIDED BY RED HAT AND CONTRIBUTORS ’’AS
IS’’ AND ANY EXPRESS OR IMPLIED WARRANTIES,
INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL RED HAT OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.