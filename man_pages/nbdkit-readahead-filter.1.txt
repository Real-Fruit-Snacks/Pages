NAME

nbdkit-readahead-filter
- prefetch data ahead of sequential reads

SYNOPSIS

nbdkit
--filter=readahead PLUGIN

nbdkit
--filter=readahead --filter=cache PLUGIN

nbdkit
--filter=readahead --filter=cow PLUGIN cow-on-cache=true

DESCRIPTION

"nbdkit-readahead-filter"
is a filter that prefetches data when the client is
reading.

When the client
issues a read, this filter issues a parallel prefetch
(".cache") for subsequent data. Plugins which
support this command will prefetch the data, making
sequential reads faster. For plugins which do not support
this command, you can inject nbdkit-cache-filter(1)
below (after) this filter, giving approximately the same
effect. nbdkit-cow-filter(1) can be used instead of
nbdkit-cache-filter, if you add the
"cow-on-cache=true" option.

The filter uses
a simple adaptive algorithm which accelerates sequential
reads and requires no further configuration.

A similar
filter is nbdkit-scan-filter(1) which reads ahead
over the whole disk, useful if you know that the client will
be reading sequentially across most or all of the disk.

Limitations

In a number of significant cases this filter will do
nothing. The filter will print a warning message if this
happens. 
Thread model must be parallel

Use "nbdkit PLUGIN
--dump-plugin" to find the thread model of the
underlying plugin. If it does not support the
"parallel" thread model, this filter cannot
perform prefetches in parallel with the read requests.

We may be able
to lift this restriction in future.

Underlying filters or plugin
must support ".cache" (prefetch)

Very many plugins do not have
the concept of prefetching and/or do not implement the
".cache" callback, and so there is no way for this
filter to issue prefetches.

You can usually
get around this by adding --filter=cache after this
filter as explained above. It may be necessary to limit the
total size of the cache (see "CACHE MAXIMUM SIZE"
in nbdkit-cache-filter(1)).

Clients and kernels may do
readahead already

It may be the case that NBD
clients are already issuing "NBD_CMD_CACHE" (NBD
prefetch) commands. It may also be the case that your plugin
is using local file functions where the kernel is doing
readahead. In such cases this filter is not necessary and
may be pessimal.

PARAMETERS

There are no
parameters specific to nbdkit-readahead-filter. Any
parameters are passed through to and processed by the
underlying plugin in the normal way.

FILES

$filterdir/nbdkit-readahead-filter.so

The filter.

Use
"nbdkit --dump-config" to find the location of
$filterdir.

VERSION

"nbdkit-readahead-filter"
first appeared in nbdkit 1.12.

SEE ALSO

nbdkit(1),
nbdkit-cache-filter(1), nbdkit-cow-filter(1),
nbdkit-file-plugin(1), nbdkit-retry-filter(1),
nbdkit-scan-filter(1),
nbdkit-torrent-plugin(1),
nbdkit-vddk-plugin(1), nbdkit-filter(3),
qemu-img(1).

AUTHORS

Richard W.M.
Jones

COPYRIGHT

Copyright Red
Hat

LICENSE

Redistribution
and use in source and binary forms, with or without
modification, are permitted provided that the following
conditions are met:

•

Redistributions of source code must retain the above
copyright notice, this list of conditions and the following
disclaimer. 

•

Redistributions in binary form must reproduce the above
copyright notice, this list of conditions and the following
disclaimer in the documentation and/or other materials
provided with the distribution.

•

Neither the name of Red Hat nor the names of its
contributors may be used to endorse or promote products
derived from this software without specific prior written
permission. 

THIS SOFTWARE
IS PROVIDED BY RED HAT AND CONTRIBUTORS ’’AS
IS’’ AND ANY EXPRESS OR IMPLIED WARRANTIES,
INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL RED HAT OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.