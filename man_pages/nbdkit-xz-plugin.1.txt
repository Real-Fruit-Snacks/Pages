NAME

nbdkit&minus;xz&minus;plugin
&minus; nbdkit xz plugin

SYNOPSIS

 nbdkit xz [file=]FILENAME.xz

DEPRECATED

The xz
plugin is deprecated in nbdkit &ge; 1.9.2 and will
be removed in nbdkit 1.12. It has been replaced
with a filter with the same functionality, see
nbdkit&minus;xz&minus;filter(1). You can use the
filter like this:

 nbdkit &minus;&minus;filter=xz file file.xz

DESCRIPTION

"nbdkit&minus;xz&minus;plugin"
is a file serving plugin for nbdkit(1).

It serves the
named "FILENAME.xz" over
NBD, uncompressing it on the fly. The plugin
only supports read-only connections.

GETTING
BEST RANDOM ACCESS PERFORMANCE FROM XZ 
xz(1) files are split into streams and blocks. Most xz
files contain only one stream which contains one or more
blocks. You can find out how many streams and blocks are in
an xz file by doing:

 $ xz &minus;&minus;list winxp.img.xz
 Strms  Blocks   Compressed Uncompressed  Ratio  Check   Filename
     1       1  2,100.0 MiB  6,144.0 MiB  0.342  CRC64   winxp.img.xz
    &uarr;&uarr;&uarr;     &uarr;&uarr;&uarr;
  streams  blocks

xz files are
seekable on block boundaries only. Seeking is done by
seeking directly to the lower block boundary, then
uncompressing data until the precise byte is reached. As
uncompressing xz data is slow, to get best random access
performance, you must prepare your xz files with many small
blocks.

Use the
&minus;&minus;block&minus;size option with a
small-ish block size. For example this is the same image
compressed with a 16 MB block size:

 $ xz &minus;&minus;best &minus;&minus;block&minus;size=16777216 winxp.img
             &#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;
 $ xz &minus;&minus;list winxp.img.xz
 Strms  Blocks   Compressed Uncompressed  Ratio  Check   Filename
     1     384  2,120.1 MiB  6,144.0 MiB  0.345  CRC64   winxp.img.xz
           &uarr;&uarr;&uarr;
          blocks

This file can
be accessed randomly. At most 16 MB will have
to be uncompressed to seek to any byte.

As you would
expect, xz cannot compress as efficiently when using a
smaller block size. The space penalty in the above example
is 

PARAMETERS

file=
FILENAME .xz

Serve the file named
"FILENAME.xz".

This parameter
is required.

In nbdkit &ge;
1.8, "file=" may be omitted. To ensure
that the filename does not end up being parsed accidentally
as "key=value", prefix relative paths
with "./" (absolute paths do not need
modification).

maxblock=
SIZE

The maximum block size that the
plugin will read. The plugin will refuse to read xz files
that contain any block larger than this size.

See the
discussion above about creating xz files with small block
sizes in order to reduce memory usage and increase
performance.

This parameter
is optional. If not specified it defaults to 512M.

maxdepth=N

Maximum number of blocks stored
in the LRU block cache.

This parameter
is optional. If not specified it defaults to 8.

The plugin may
allocate up to
maximum block size in file * maxdepth
bytes of memory per connection.

SEE ALSO

nbdkit(1),
nbdkit&minus;plugin(3), xz(1).

AUTHORS

Richard W.M.
Jones

COPYRIGHT

Copyright (C)
2013 Red Hat Inc.

LICENSE

Redistribution
and use in source and binary forms, with or without
modification, are permitted provided that the following
conditions are met:

&bull;

Redistributions of source code must retain the above
copyright notice, this list of conditions and the following
disclaimer. 

&bull;

Redistributions in binary form must reproduce the above
copyright notice, this list of conditions and the following
disclaimer in the documentation and/or other materials
provided with the distribution.

&bull;

Neither the name of Red Hat nor the names of its
contributors may be used to endorse or promote products
derived from this software without specific prior written
permission. 

THIS
SOFTWARE IS PROVIDED BY RED HAT AND CONTRIBUTORS
&rsquo;&rsquo; AS IS &rsquo;&rsquo;
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT
NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
EVENT SHALL RED HAT OR CONTRIBUTORS BE LIABLE FOR ANY
DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
CONSEQUENTIAL DAMAGES ( INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
SERVICES ; LOSS OF USE, DATA, OR
PROFITS ; OR BUSINESS INTERRUPTION )
HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (
INCLUDING NEGLIGENCE OR OTHERWISE )
ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.