NAME

nbd_connect_vsock
- connect to NBD server over AF_VSOCK protocol

SYNOPSIS

#include

int nbd_connect_vsock ( 
struct nbd_handle *h, uint32_t cid, uint32_t port 
);

DESCRIPTION

Connect
(synchronously) over the "AF_VSOCK" protocol from
a virtual machine to an NBD server, usually running on the
host. The "cid" and "port" parameters
specify the server address. Usually "cid" should
be 2 (to connect to the host), and "port" might be
10809 or another port number assigned to you by the host
administrator.

Not all systems
support "AF_VSOCK"; to determine if libnbd was
built on a system with vsock support, see
nbd_supports_vsock(3).

This call
returns when the connection has been made. By default, this
proceeds all the way to transmission phase, but
nbd_set_opt_mode(3) can be used for manual control
over option negotiation performed before transmission
phase.

RETURN VALUE

If the call is
successful the function returns 0.

ERRORS

On error -1 is
returned.

Refer to
"ERROR HANDLING" in libnbd(3) for how to
get further details of the error.

The following
parameters must not be NULL: "h". For more
information see "Non-NULL parameters" in
libnbd(3).

HANDLE STATE

nbd_connect_vsock
can be called when the handle is in the following state:

┌─────────────────────────────────────┬─────────────────────────┐

│ Handle created, before connecting │ ✅
allowed │ 
│ Connecting │ ❌ error │ 
│ Connecting & handshaking (opt_mode) │
❌ error │ 
│ Connected to the server │ ❌ error
│ 
│ Connection shut down │ ❌ error │

│ Handle dead │ ❌ error │ 

└─────────────────────────────────────┴─────────────────────────┘

VERSION

This function
first appeared in libnbd 1.2.

If you need to
test if this function is available at compile time check if
the following macro is defined:

#define
LIBNBD_HAVE_NBD_CONNECT_VSOCK 1

SEE ALSO

nbd_aio_connect_vsock(3),
nbd_create(3), nbd_set_opt_mode(3),
nbd_supports_vsock(3), libnbd(3).

AUTHORS

Eric Blake

Richard W.M.
Jones

COPYRIGHT

Copyright Red
Hat

LICENSE

This library is
free software; you can redistribute it and/or modify it
under the terms of the GNU Lesser General Public License as
published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This library is
distributed in the hope that it will be useful, but WITHOUT
ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU Lesser General Public License for more details.

You should have
received a copy of the GNU Lesser General Public License
along with this library; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
MA 02110-1301 USA